# AST Creator для языка 1С

Проект для создания абстрактного синтаксического дерева (AST) из кода на языке 1С:Предприятие.

## Описание проекта

AST Creator предназначен для разбора исходного кода на языке 1С:Предприятие и построения абстрактного синтаксического дерева. Этот проект может использоваться для анализа, рефакторинга и преобразования кода на 1С.

## Основные возможности

- Парсинг кода на языке 1С и построение синтаксического дерева
- Версионирование грамматики с возможностью отката к предыдущим версиям
- Автоматическое расширение грамматики с помощью AI-агентов
- Обработка и информативные сообщения о синтаксических ошибках
- Поддержка как кириллических, так и латинских идентификаторов

## Структура проекта

```
ast_create/
├── agents/                 # Модули для работы с AI-агентами
│   ├── agent_coordinator.py  # Координация работы AI-агентов
│   ├── grammar_agent.py      # Агент для автоматического расширения грамматики
│   └── __init__.py
├── config/                 # Конфигурация проекта
│   ├── config.py             # Основные настройки
│   └── __init__.py
├── docs/                   # Документация
│   └── grammar_docs.md       # Документация по грамматике
├── grammar/                # Модули для работы с грамматикой
│   ├── 1c_base.lark          # Базовая грамматика в формате Lark
│   ├── grammar_manager.py    # Менеджер версионирования грамматики
│   ├── parser.py             # Парсер для языка 1С
│   ├── simple_parser.py      # Упрощенная версия парсера
│   ├── versions/             # Хранилище версий грамматики
│   └── __init__.py
├── tests/                  # Тесты
│   ├── test_grammar_manager.py  # Тесты для менеджера грамматики
│   ├── test_parser.py           # Тесты для парсера
│   └── __init__.py
└── __init__.py
```

## Новые возможности

### Система версионирования грамматики

Проект теперь включает полноценную систему версионирования грамматики:

- Каждая версия грамматики имеет уникальный идентификатор, описание и метку времени
- Поддерживается сохранение и загрузка версий грамматики из JSON-файлов
- Реализован механизм отката к предыдущим версиям
- Автоматическое создание резервных копий всех версий

### AI-агенты для расширения грамматики

Добавлена поддержка AI-агентов для автоматического расширения грамматики:

- Анализ ошибок парсинга и выявление неизвестных конструкций
- Автоматическое создание новых правил грамматики
- Валидация сгенерированных правил
- Интеграция новых правил в текущую грамматику

## Использование

### Установка зависимостей

```bash
pip install -r requirements.txt
```

### Парсинг кода

```python
from ast_create.grammar.parser import Parser

# Создаем экземпляр парсера
parser = Parser()

# Парсим код
code = """
Перем Счетчик;

Процедура УвеличитьСчетчик()
    Счетчик = Счетчик + 1;
КонецПроцедуры
"""

# Получаем синтаксическое дерево
tree = parser.parse(code)
```

### Работа с версиями грамматики

```python
from ast_create.grammar.grammar_manager import get_grammar_manager

# Получаем менеджер грамматики
grammar_manager = get_grammar_manager()

# Получаем список всех версий
versions = grammar_manager.get_all_versions()

# Откатываемся к предыдущей версии
grammar_manager.rollback_to_version(versions[0].version_id)

# Расширяем грамматику новым правилом
new_rule = """
// Правило для цикла "Для каждого"
foreach_statement: "Для" "каждого" IDENTIFIER "Из" expression "Цикл" statement+ "КонецЦикла" ";"?

// Обновление правила statement
?statement: var_declaration | assignment | if_statement | foreach_statement
"""

grammar_manager.extend_grammar(new_rule, "Добавление цикла 'Для каждого'")
```

### Использование AI-агентов

```python
from ast_create.agents.agent_coordinator import get_agent_coordinator
from ast_create.config import config

# Включаем агенты в конфигурации
config.agent.enabled = True
config.agent.auto_update_grammar = True

# Получаем координатор агентов
agent_coordinator = get_agent_coordinator()

# Обрабатываем ошибку парсинга
try:
    tree = parser.parse(complex_code)
except Exception as e:
    success = agent_coordinator.process_parse_error(e, complex_code)
    if success:
        # Пробуем снова с обновленной грамматикой
        tree = parser.parse(complex_code)
```

## Дополнительная документация

Дополнительная документация доступна в директории `docs`:

- [Документация по грамматике](ast_create/docs/grammar_docs.md) - описание грамматики и системы версионирования

## Лицензия

[MIT License](LICENSE) 